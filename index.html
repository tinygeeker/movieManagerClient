<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ÁîµÂΩ±ÁÆ°ÁêÜÂô®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        h1 {
            color: #333;
            margin: 0;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0;
        }
        
        .header h1 {
            margin: 0;
        }
        
        .header .settings-menu {
            margin-left: auto;
        }
        
        .settings-menu {
            position: relative;
        }
        
        #settings-button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            font-size: 14px;
        }
        
        #settings-button:hover {
            background-color: #f5f5f5;
        }
        
        .settings-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 5px 0;
            min-width: 150px;
            display: none;
            z-index: 1000;
        }
        
        .settings-dropdown a,
        .settings-dropdown button {
            display: block;
            padding: 8px 16px;
            text-decoration: none;
            color: #333;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
        }
        
        .settings-dropdown a:hover,
        .settings-dropdown button:hover {
            background-color: #f5f5f5;
        }
        
        .settings-dropdown.show {
            display: block;
        }
        
        .donate-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
        
        .donate-modal.show {
            display: flex;
        }
        
        .donate-content {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            max-width: 900px;
            width: 95%;
            text-align: center;
        }
        
        .donate-content img {
            max-width: 100%;
            max-height: 700px;
            border-radius: 4px;
        }
        
        .donate-close {
            margin-top: 15px;
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
        }
        
        .donate-close:hover {
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
        }
        
        .directory-info {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .content {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .sidebar {
            width: 250px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .sidebar h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #343a40;
            font-size: 16px;
            font-weight: 600;
        }
        
        .main-content {
            flex: 1;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .main-content h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #343a40;
            font-size: 18px;
            font-weight: 600;
        }
        
        .folder-list, .movie-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .folder-item, .movie-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            background-color: #fff;
            border: 1px solid #e9ecef;
            white-space: nowrap;
            overflow: hidden;
            min-height: 40px;
        }
        
        .folder-item strong {
            display: inline-block;
            margin-right: 10px;
        }
        
        .folder-item:hover, .movie-item:hover {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            transform: translateX(3px);
        }
        
        .folder-path {
            font-size: 12px;
            color: #6c757d;
            margin-left: 10px;
            font-weight: normal;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .folder-name {
            font-weight: 500;
            color: #495057;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .movie-grid {
            display: grid;
            grid-template-columns: repeat(5, 220px);
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
        }
        
        .pagination button:hover {
            background-color: #f5f5f5;
        }
        
        .pagination button:disabled {
            background-color: #f9f9f9;
            cursor: not-allowed;
            color: #ccc;
        }
        
        .pagination .page-info {
            font-size: 14px;
            color: #666;
        }
        
        .movie-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
        }
        
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-color: #dee2e6;
        }
        
        .movie-thumbnail {
            width: 100%;
            height: 293px;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #ccc;
            position: relative;
            overflow: hidden;
        }
        
        .thumbnail-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .movie-info {
            font-size: 14px;
        }
        
        .movie-title {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .movie-duration {
            color: #666;
            margin-bottom: 5px;
        }
        
        .movie-details-hover {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
        }
        
        .movie-card:hover .movie-details-hover {
            display: flex;
        }
        
        .movie-details-hover h4 {
            margin-top: 0;
            margin-bottom: 10px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.2;
            font-size: 16px;
        }
        
        .movie-details-hover .detail-item {
            margin: 5px 0;
            font-size: 12px;
        }
        
        .movie-details-hover .detail-label {
            font-weight: bold;
            margin-right: 5px;
        }
        
        .movie-details {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .detail-item {
            margin: 10px 0;
        }
        
        .detail-label {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ÁîµÂΩ±ÁÆ°ÁêÜÂô®</h1>
        </div>
        
        <!-- ÁßªÈô§È°∂ÈÉ®ÁöÑÂΩìÂâçÁõÆÂΩïÊòæÁ§∫ -->
        
        <div class="content">
            <div class="sidebar">
                <h3>Êñá‰ª∂Â§π</h3>
                <ul class="folder-list" id="folder-list">
                    <li class="folder-item" data-path=".">
                        <strong>ÂΩìÂâçÁõÆÂΩï</strong>
                    </li>
                </ul>
            </div>
            
            <div class="main-content">
                <h3>ÁîµÂΩ±ÂàóË°®</h3>
                <div class="movie-grid" id="movie-grid">
                    <!-- ÁîµÂΩ±Âç°ÁâáÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <div class="pagination" id="pagination">
                    <button id="prev-page" disabled>‰∏ä‰∏ÄÈ°µ</button>
                    <span class="page-info" id="page-info">Á¨¨ 1 È°µÔºåÂÖ± 1 È°µ</span>
                    <button id="next-page" disabled>‰∏ã‰∏ÄÈ°µ</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const { electronAPI } = window;
        const path = require('path');
        const fs = require('fs');
        
        let currentDirectory = '.';
        let allMovies = [];
        let currentPage = 1;
        const moviesPerPage = 20;
        
        document.addEventListener('DOMContentLoaded', async () => {
            await updateCurrentDirectory();
            await scanDirectory(currentDirectory);
            
            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠ÂèØËÉΩÁöÑËÆæÁΩÆËèúÂçï
            document.addEventListener('click', (event) => {
                const settingsDropdown = document.getElementById('settings-dropdown');
                if (settingsDropdown && !event.target.closest('.settings-menu')) {
                    settingsDropdown.classList.remove('show');
                }
            });
            
            // Ê∑ªÂä†ÂàÜÈ°µÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.getElementById('prev-page').addEventListener('click', goToPrevPage);
            document.getElementById('next-page').addEventListener('click', goToNextPage);
        });
        
        async function updateCurrentDirectory() {
            const appDir = process.cwd();
            currentDirectory = appDir;
        }
        
        async function scanDirectory(directoryPath) {
            console.log('Scanning directory:', directoryPath);
            
            // Áõ¥Êé•‰ªéÂâçÁ´ØËØªÂèñÁõÆÂΩïÂÜÖÂÆπÔºå‰∏ç‰æùËµñ‰∏ªËøõÁ®ã
            try {
                const fs = require('fs');
                const path = require('path');
                
                const items = fs.readdirSync(directoryPath);
                console.log('Direct read items:', items);
                
                // ÂàÜÁ¶ªÊñá‰ª∂Â§πÂíåÁîµÂΩ±Êñá‰ª∂
                const folders = [];
                const movies = [];
                
                items.forEach(item => {
                    try {
                        const itemPath = path.join(directoryPath, item);
                        const stats = fs.statSync(itemPath);
                        
                        if (stats.isDirectory()) {
                            console.log('Found folder:', item);
                            folders.push({
                                name: item,
                                path: itemPath
                            });
                        } else if (stats.isFile()) {
                            const lowerItem = item.toLowerCase();
                            const isVideo = lowerItem.endsWith('.mp4') || 
                                           lowerItem.endsWith('.mkv') || 
                                           lowerItem.endsWith('.avi') || 
                                           lowerItem.endsWith('.mov') || 
                                           lowerItem.endsWith('.wmv') || 
                                           lowerItem.endsWith('.flv') || 
                                           lowerItem.endsWith('.webm');
                            
                            if (isVideo) {
                                console.log('Found movie:', item);
                                movies.push({
                                    name: item,
                                    path: itemPath
                                });
                            }
                        }
                    } catch (err) {
                        console.error('Error processing item:', item, err);
                    }
                });
                
                console.log('Final folders:', folders);
                console.log('Final movies:', movies);
                
                updateFolderList(folders);
                allMovies = movies;
                currentPage = 1;
                updateMovieGrid();
            } catch (err) {
                console.error('Error scanning directory:', err);
                updateFolderList([]);
                allMovies = [];
                updateMovieGrid();
            }
        }
        
        function updateFolderList(folders) {
            console.log('Updating folder list with:', folders);
            
            const folderList = document.getElementById('folder-list');
            const path = require('path');
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÁà∂ÁõÆÂΩï
            const hasParent = currentDirectory !== '.' && currentDirectory !== process.cwd();
            
            // ÊûÑÂª∫Êñá‰ª∂Â§πÂàóË°®HTML
            let folderListHTML = `
                <li class="folder-item" data-path=".">
                    <strong>ÂΩìÂâçÁõÆÂΩï</strong>
                    <span class="folder-path">${path.basename(currentDirectory)}</span>
                </li>
            `;
            
            // Ê∑ªÂä†ËøîÂõûÊåâÈíÆ
            if (hasParent) {
                folderListHTML += `
                    <li class="folder-item" data-path="..">
                        <strong>ËøîÂõû‰∏ä‰∏ÄÁ∫ß</strong>
                    </li>
                `;
            }
            
            folderList.innerHTML = folderListHTML;
            
            console.log('Found folders count:', folders.length);
            
            // Ê∑ªÂä†Êñá‰ª∂Â§π
            folders.forEach(folder => {
                console.log('Adding folder:', folder.name);
                const li = document.createElement('li');
                li.className = 'folder-item';
                li.dataset.path = folder.path;
                
                // Ê∑ªÂä†Êñá‰ª∂Â§πÂêçÁß∞ÂíåË∑ØÂæÑ
                li.innerHTML = `
                    <span class="folder-name">${folder.name}</span>
                `;
                
                li.addEventListener('click', () => {
                    currentDirectory = folder.path;
                    scanDirectory(folder.path);
                });
                folderList.appendChild(li);
            });
            
            // Ê∑ªÂä†ËøîÂõûÊåâÈíÆÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
            if (hasParent) {
                const backButton = folderList.querySelector('[data-path=".."]');
                if (backButton) {
                    backButton.addEventListener('click', () => {
                        const parentPath = path.dirname(currentDirectory);
                        currentDirectory = parentPath;
                        scanDirectory(parentPath);
                    });
                }
            }
        }
        
        function updateMovieGrid() {
            console.log('Updating movie grid with movies:', allMovies);
            
            const movieGrid = document.getElementById('movie-grid');
            movieGrid.innerHTML = '';
            
            // ËÆ°ÁÆóÂΩìÂâçÈ°µÁöÑÁîµÂΩ±
            const startIndex = (currentPage - 1) * moviesPerPage;
            const endIndex = startIndex + moviesPerPage;
            const currentMovies = allMovies.slice(startIndex, endIndex);
            
            console.log('Current page movies:', currentMovies);
            
            if (currentMovies.length === 0) {
                console.log('No movies to display');
                movieGrid.innerHTML = '<p>ÂΩìÂâçÁõÆÂΩïÊ≤°ÊúâËßÜÈ¢ëÊñá‰ª∂</p>';
            } else {
                console.log('Displaying', currentMovies.length, 'movies');
                currentMovies.forEach((movie, index) => {
                    console.log('Creating movie card for:', movie.name);
                    
                    const movieCard = document.createElement('div');
                    movieCard.className = 'movie-card';
                    
                    // ‰∏∫ËßÜÈ¢ëÁîüÊàêÂîØ‰∏ÄÁöÑÂ∞ÅÈù¢È¢úËâ≤
                    function getColorFromName(name) {
                        let hash = 0;
                        for (let i = 0; i < name.length; i++) {
                            hash = name.charCodeAt(i) + ((hash << 5) - hash);
                        }
                        const c = (hash & 0x00FFFFFF)
                            .toString(16)
                            .toUpperCase();
                        return "#" + "00000".substring(0, 6 - c.length) + c;
                    }
                    
                    const thumbnailColor = getColorFromName(movie.name);
                    
                    movieCard.innerHTML = `
                        <div class="movie-thumbnail" style="background-color: ${thumbnailColor};">
                            <img class="video-thumbnail" src="" alt="ËßÜÈ¢ëÂ∞ÅÈù¢" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                            <div class="thumbnail-placeholder">
                                <div style="font-size: 64px;">üé¨</div>
                                <div style="font-size: 14px; margin-top: 10px; color: rgba(255, 255, 255, 0.8);">${path.extname(movie.name).substring(1).toUpperCase()}</div>
                            </div>
                            <div class="movie-details-hover">
                                <h4>${movie.name}</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ê†ºÂºè:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Êó∂Èïø:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Êñá‰ª∂Â§ßÂ∞è:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÂàÜËæ®Áéá:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÁºñÁ†Å:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÊØîÁâπÁéá:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Â∏ßÁéá:</span>
                                    <span>Âä†ËΩΩ‰∏≠...</span>
                                </div>
                                <div class="detail-item" style="margin-top: 10px; font-size: 12px; color: #ccc;">
                                    <span>ÊèêÁ§∫: ÂÆâË£ÖffprobeÂíåffmpegÂèØÊòæÁ§∫Êõ¥Â§ö‰ø°ÊÅØ</span>
                                </div>
                            </div>
                        </div>
                        <div class="movie-info">
                            <div class="movie-title">${movie.name}</div>
                            <div class="movie-duration">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                    `;
                    
                    // Ê∑ªÂä†ÁÇπÂáªÊí≠ÊîæÂäüËÉΩ
                    movieCard.addEventListener('click', () => {
                        console.log('Playing movie:', movie.path);
                        try {
                            const { shell } = require('electron');
                            shell.openPath(movie.path);
                        } catch (err) {
                            console.error('Error playing movie:', err);
                            alert('Êó†Ê≥ïÊí≠ÊîæËßÜÈ¢ëÊñá‰ª∂ÔºåËØ∑Á°Æ‰øùÊÇ®ÁöÑÁ≥ªÁªüÊúâÈªòËÆ§ÁöÑËßÜÈ¢ëÊí≠ÊîæÂô®');
                        }
                    });
                    
                    movieGrid.appendChild(movieCard);
                    
                    // Ëé∑ÂèñÁîµÂΩ±‰ø°ÊÅØ
                    console.log('Getting movie info for:', movie.path);
                    getMovieInfo(movie.path, movieCard);
                });
            }
            
            // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
            updatePagination();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(allMovies.length / moviesPerPage);
            const pageInfo = document.getElementById('page-info');
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            
            pageInfo.textContent = `Á¨¨ ${currentPage} È°µÔºåÂÖ± ${totalPages} È°µ`;
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }
        
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateMovieGrid();
            }
        }
        
        function goToNextPage() {
            const totalPages = Math.ceil(allMovies.length / moviesPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateMovieGrid();
            }
        }
        
        async function getMovieInfo(moviePath, movieCard) {
            console.log('Getting movie info for:', moviePath);
            
            try {
                const fs = require('fs');
                const path = require('path');
                const { execSync } = require('child_process');
                
                // Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
                let fileSize = 'Êú™Áü•';
                try {
                    const stats = fs.statSync(moviePath);
                    const sizeInMB = (stats.size / (1024 * 1024)).toFixed(2);
                    fileSize = `${sizeInMB} MB`;
                } catch (err) {
                    console.error('Error getting file size:', err);
                }
                
                // Ëé∑ÂèñÊñá‰ª∂Ê†ºÂºè
                const ext = path.extname(moviePath).substring(1).toUpperCase();
                const format = ext || 'Êú™Áü•';
                
                // Êõ¥Êñ∞Âç°Áâá‰∏äÁöÑÊó∂Èïø‰ø°ÊÅØ
                const durationElement = movieCard.querySelector('.movie-duration');
                durationElement.textContent = 'Êú™Áü•Êó∂Èïø';
                
                // Êõ¥Êñ∞ÊÇ¨ÊµÆÊó∂ÊòæÁ§∫ÁöÑËØ¶ÊÉÖ‰ø°ÊÅØ
                const hoverDetails = movieCard.querySelector('.movie-details-hover');
                if (hoverDetails) {
                    // Êõ¥Êñ∞Ê†ºÂºè
                    const formatElement = hoverDetails.querySelector('.detail-item:nth-child(2) span:nth-child(2)');
                    if (formatElement) {
                        formatElement.textContent = format;
                    }
                    
                    // Êõ¥Êñ∞Êó∂Èïø
                    const durationHoverElement = hoverDetails.querySelector('.detail-item:nth-child(3) span:nth-child(2)');
                    if (durationHoverElement) {
                        durationHoverElement.textContent = 'Êú™Áü•';
                    }
                    
                    // Êõ¥Êñ∞Êñá‰ª∂Â§ßÂ∞è
                    const sizeElement = hoverDetails.querySelector('.detail-item:nth-child(4) span:nth-child(2)');
                    if (sizeElement) {
                        sizeElement.textContent = fileSize;
                    }
                    
                    // Êõ¥Êñ∞ÂàÜËæ®Áéá
                    const resolutionElement = hoverDetails.querySelector('.detail-item:nth-child(5) span:nth-child(2)');
                    if (resolutionElement) {
                        resolutionElement.textContent = 'Êú™Áü•';
                    }
                    
                    // Êõ¥Êñ∞ÁºñÁ†Å
                    const codecElement = hoverDetails.querySelector('.detail-item:nth-child(6) span:nth-child(2)');
                    if (codecElement) {
                        codecElement.textContent = 'Êú™Áü•';
                    }
                    
                    // Êõ¥Êñ∞ÊØîÁâπÁéá
                    const bitrateElement = hoverDetails.querySelector('.detail-item:nth-child(7) span:nth-child(2)');
                    if (bitrateElement) {
                        bitrateElement.textContent = 'Êú™Áü•';
                    }
                    
                    // Êõ¥Êñ∞Â∏ßÁéá
                    const fpsElement = hoverDetails.querySelector('.detail-item:nth-child(8) span:nth-child(2)');
                    if (fpsElement) {
                        fpsElement.textContent = 'Êú™Áü•';
                    }
                }
                
                // Â∞ùËØï‰ΩøÁî®Á≥ªÁªüÂëΩ‰ª§Ëé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ
                try {
                    const { execSync } = require('child_process');
                    const path = require('path');
                    
                    // Ê£ÄÊü•ffprobeÊòØÂê¶ÂèØÁî®ÔºàÂ∞ùËØïÂ§öÁßçÂèØËÉΩÁöÑË∑ØÂæÑÔºâ
                    let ffprobePath = 'ffprobe';
                    let ffmpegPath = 'ffmpeg';
                    
                    // Â∞ùËØïÂ∏∏ËßÅÁöÑffmpegÂÆâË£ÖË∑ØÂæÑ
                    const commonPaths = [
                        'ffprobe',
                        'C:\\ffmpeg\\bin\\ffprobe.exe',
                        'D:\\ffmpeg\\bin\\ffprobe.exe',
                        'E:\\ffmpeg\\bin\\ffprobe.exe',
                        'F:\\ffmpeg\\bin\\ffprobe.exe',
                        '/usr/bin/ffprobe',
                        '/usr/local/bin/ffprobe'
                    ];
                    
                    let ffprobeAvailable = false;
                    for (const testPath of commonPaths) {
                        try {
                            execSync(`${testPath} -version`, { stdio: 'ignore' });
                            ffprobePath = testPath;
                            ffmpegPath = testPath.replace('ffprobe', 'ffmpeg');
                            ffprobeAvailable = true;
                            break;
                        } catch (e) {
                            // ÁªßÁª≠Â∞ùËØï‰∏ã‰∏Ä‰∏™Ë∑ØÂæÑ
                        }
                    }
                    
                    if (!ffprobeAvailable) {
                        throw new Error('ffprobe not found');
                    }
                    
                    // Ëé∑ÂèñËßÜÈ¢ëÂÖÉÊï∞ÊçÆ
                    const command = `"${ffprobePath}" -v quiet -print_format json -show_format -show_streams "${moviePath}"`;
                    const output = execSync(command, { encoding: 'utf8' });
                    const info = JSON.parse(output);
                    
                    // Êõ¥Êñ∞Êó∂Èïø
                    if (info.format && info.format.duration) {
                        const duration = parseFloat(info.format.duration);
                        const hours = Math.floor(duration / 3600);
                        const minutes = Math.floor((duration % 3600) / 60);
                        const seconds = Math.floor(duration % 60);
                        durationElement.textContent = `${hours}h ${minutes}m`;
                        
                        if (hoverDetails) {
                            const durationHoverElement = hoverDetails.querySelector('.detail-item:nth-child(3) span:nth-child(2)');
                            if (durationHoverElement) {
                                durationHoverElement.textContent = `${hours}h ${minutes}m ${seconds}s`;
                            }
                        }
                    }
                    
                    // Êõ¥Êñ∞ÂàÜËæ®ÁéáÂíåÂÖ∂‰ªñËßÜÈ¢ëÂ±ûÊÄß
                    if (info.streams) {
                        const videoStream = info.streams.find(stream => stream.codec_type === 'video');
                        if (videoStream) {
                            // Êõ¥Êñ∞ÂàÜËæ®Áéá
                            if (videoStream.width && videoStream.height) {
                                if (hoverDetails) {
                                    const resolutionElement = hoverDetails.querySelector('.detail-item:nth-child(5) span:nth-child(2)');
                                    if (resolutionElement) {
                                        resolutionElement.textContent = `${videoStream.width}x${videoStream.height}`;
                                    }
                                }
                            }
                            
                            // Êõ¥Êñ∞ÁºñÁ†ÅÊ†ºÂºè
                            if (videoStream.codec_name) {
                                if (hoverDetails) {
                                    const codecElement = hoverDetails.querySelector('.detail-item:nth-child(6) span:nth-child(2)');
                                    if (codecElement) {
                                        codecElement.textContent = videoStream.codec_name.toUpperCase();
                                    }
                                }
                            }
                            
                            // Êõ¥Êñ∞Â∏ßÁéá
                            if (videoStream.r_frame_rate) {
                                if (hoverDetails) {
                                    const fpsElement = hoverDetails.querySelector('.detail-item:nth-child(8) span:nth-child(2)');
                                    if (fpsElement) {
                                        // Ëß£ÊûêÂ∏ßÁéá
                                        const [num, den] = videoStream.r_frame_rate.split('/').map(Number);
                                        const fps = den ? (num / den).toFixed(1) : videoStream.r_frame_rate;
                                        fpsElement.textContent = `${fps} FPS`;
                                    }
                                }
                            }
                        }
                    }
                    
                    // Êõ¥Êñ∞ÊØîÁâπÁéá
                    if (info.format && info.format.bit_rate) {
                        if (hoverDetails) {
                            const bitrateElement = hoverDetails.querySelector('.detail-item:nth-child(7) span:nth-child(2)');
                            if (bitrateElement) {
                                const bitrate = parseInt(info.format.bit_rate);
                                const bitrateMbps = (bitrate / 1000000).toFixed(2);
                                bitrateElement.textContent = `${bitrateMbps} Mbps`;
                            }
                        }
                    }
                    
                    // Â∞ùËØï‰ªéËßÜÈ¢ë‰∏≠ÊèêÂèñÂ∏ß‰Ωú‰∏∫Â∞ÅÈù¢
                    try {
                        // Ê£ÄÊü•ffmpegÊòØÂê¶ÂèØÁî®
                        execSync(`"${ffmpegPath}" -version`, { stdio: 'ignore' });
                        
                        const thumbnailPath = path.join(process.cwd(), 'thumbnails');
                        if (!fs.existsSync(thumbnailPath)) {
                            fs.mkdirSync(thumbnailPath, { recursive: true });
                        }
                        
                        const thumbnailFileName = `${path.basename(moviePath, path.extname(moviePath))}.jpg`;
                        const thumbnailFullPath = path.join(thumbnailPath, thumbnailFileName);
                        
                        // Ê£ÄÊü•Áº©Áï•ÂõæÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®
                        if (!fs.existsSync(thumbnailFullPath)) {
                            // ‰ΩøÁî®ffmpegÊèêÂèñËßÜÈ¢ëÁ¨¨‰∏ÄÂ∏ß
                            const extractCommand = `"${ffmpegPath}" -i "${moviePath}" -ss 00:00:01 -vframes 1 -s 400x300 "${thumbnailFullPath}"`;
                            execSync(extractCommand, { stdio: 'ignore' });
                        }
                        
                        // Ê£ÄÊü•Áº©Áï•ÂõæÊòØÂê¶ÁîüÊàêÊàêÂäü
                        if (fs.existsSync(thumbnailFullPath)) {
                            const thumbnailElement = movieCard.querySelector('.video-thumbnail');
                            const placeholderElement = movieCard.querySelector('.thumbnail-placeholder');
                            
                            if (thumbnailElement && placeholderElement) {
                                thumbnailElement.src = thumbnailFullPath;
                                thumbnailElement.style.display = 'block';
                                placeholderElement.style.display = 'none';
                            }
                        }
                    } catch (extractErr) {
                        // ÈùôÈªòÂ§ÑÁêÜffmpegÈîôËØØÔºå‰∏çÊòæÁ§∫Âú®ÊéßÂà∂Âè∞
                        // ÁªßÁª≠‰ΩøÁî®ÈªòËÆ§Áº©Áï•Âõæ
                    }
                } catch (err) {
                    // ÈùôÈªòÂ§ÑÁêÜffprobeÈîôËØØÔºå‰∏çÊòæÁ§∫Âú®ÊéßÂà∂Âè∞
                    // ÁªßÁª≠‰ΩøÁî®Âü∫Êú¨‰ø°ÊÅØ
                }
                
                // Áõ¥Êé•‰ªéÊñá‰ª∂Á≥ªÁªüËé∑ÂèñÂü∫Êú¨‰ø°ÊÅØÔºå‰∏ç‰æùËµñ ffprobe
                console.log('File format:', format);
                console.log('File size:', fileSize);
                
                // Â∞ùËØï‰ªéÊñá‰ª∂Êâ©Â±ïÂêçÊé®Êñ≠Êõ¥Â§ö‰ø°ÊÅØ
                if (format) {
                    console.log('Successfully got file format:', format);
                }
                
                if (fileSize !== 'Êú™Áü•') {
                    console.log('Successfully got file size:', fileSize);
                }
                
                // Âç≥‰ΩøÊ≤°Êúâ ffprobeÔºå‰πüÊòæÁ§∫Âü∫Êú¨‰ø°ÊÅØ
                console.log('Updating movie info with basic data');
                
            } catch (error) {
                console.error('Error getting movie info:', error);
                const durationElement = movieCard.querySelector('.movie-duration');
                durationElement.textContent = 'Êó†Ê≥ïËé∑Âèñ‰ø°ÊÅØ';
                
                // Êõ¥Êñ∞ÊÇ¨ÊµÆÊó∂ÊòæÁ§∫ÁöÑËØ¶ÊÉÖ‰ø°ÊÅØ
                const hoverDetails = movieCard.querySelector('.movie-details-hover');
                if (hoverDetails) {
                    const detailElements = hoverDetails.querySelectorAll('.detail-item span:nth-child(2)');
                    detailElements.forEach(element => {
                        element.textContent = 'Êó†Ê≥ïËé∑Âèñ';
                    });
                }
            }
        }
    </script>
</body>
</html>